# Add tables required by the historical data gateway

## The problem we're trying to solve

We have added a new historical data staging database that will be used with the new historical data gateway. We need to add all new tables to the database in preparation for the API deployment and decommissioning of the platform API.   

## Justification for doing a manual update

We don't have automated migration scripts yet.

## The plan

1. Run the SQL scripts below. Please note this is for staging database on staging account only. Production database and tables are already in place. We've never had staging db for this read only data, so this will help to resolve some of the tech debt we have.

## Link to Jira ticket

https://hackney.atlassian.net/browse/SCT-1628

## SQL statement(s)

```sql
CREATE SCHEMA IF NOT EXISTS dbo;

CREATE TABLE IF NOT EXISTS dbo.dm_case_note_types
(
    note_type varchar(16) NOT NULL PRIMARY KEY,
    note_type_description varchar(80)
);

CREATE TABLE IF NOT EXISTS dbo.workers
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    first_names varchar(30),
    last_names varchar(30),
    system_user_id varchar(64) NOT NULL,
    email_address varchar(240),
    accessible varchar(1),
    context_code varchar(1),
    CONSTRAINT "AK_workers_system_user_id" UNIQUE (system_user_id)
);

CREATE TABLE IF NOT EXISTS dbo.case_notes
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    person_id bigint NOT NULL,
    note_type varchar(16),
    title varchar(100),
    created_on timestamp NOT NULL,
    created_by varchar(30),
    last_updated_by varchar(30),
    note text,
    CONSTRAINT "FK_case_note_worker_created_by" FOREIGN KEY (created_by)
        REFERENCES dbo.workers (system_user_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS dbo.dm_visits
(
    visit_id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    person_id bigint NOT NULL,
    visit_type varchar(20) NOT NULL,
    planned_datetime timestamp,
    actual_datetime timestamp,
    reason_not_planned varchar(16),
    reason_visit_not_made varchar(16),
    seen_alone_flag varchar(1),
    completed_flag varchar(1),
    org_id bigint,
    worker_id bigint,
    cp_registration_id bigint,
    cp_visit_schedule_step_id bigint,
    cp_visit_schedule_days bigint,
    cp_visit_on_time varchar(1),
    CONSTRAINT "FK_dm_visits_workers_worker_id" FOREIGN KEY (worker_id)
        REFERENCES dbo.workers (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE RESTRICT
);
```
