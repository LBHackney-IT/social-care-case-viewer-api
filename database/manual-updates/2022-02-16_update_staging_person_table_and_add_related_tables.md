# Add tables required by the historical data gateway

## The problem we're trying to solve

We have added a new columns to the Person + several related tables, staging needs a manual update to take the changes into account.

## Justification for doing a manual update

We don't have automated migration scripts yet.

## The plan

1. Run the SQL scripts below. Please note this is for staging database on staging account only.

## Link to Jira ticket

https://hackney.atlassian.net/browse/SCT-1693

## SQL statement(s)

```sql
CREATE TABLE if not exists dbo.DM_KEY_CONTACTS (
    KEY_CONTACT_ID integer GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PERSON_ID numeric(16) NOT NULL,
    NAME varchar(255),
    EMAIL varchar(240),
    CONSTRAINT XPKDM_KEY_CONTACTS PRIMARY KEY (KEY_CONTACT_ID, PERSON_ID)
    );

CREATE TABLE if not exists dbo.DM_OTHER_EMAIL_ADDRESSES (
    EMAIL_ID integer GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PERSON_ID numeric(16) NOT NULL,
    EMAIL varchar(240),
    CONSTRAINT XPKDM_EMAILS PRIMARY KEY (EMAIL_ID, PERSON_ID)
    );


CREATE TABLE if not exists dbo.DM_GP_DETAILS (
    GP_DETAILS_ID integer GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PERSON_ID numeric(16) NOT NULL,
    NAME varchar,
    ADDRESS varchar,
    POSTCODE varchar,
    PHONE_NUMBER varchar,
    EMAIL varchar,
    CONSTRAINT XPKDM_GP_DETAILS PRIMARY KEY (GP_DETAILS_ID, PERSON_ID)
    );

CREATE TABLE if not exists dbo.DM_TECH_USE (
    TECH_USE_ID integer GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PERSON_ID numeric(16) NOT NULL,
    TECH_TYPE varchar,
    CONSTRAINT XPKDM_TECH_USE PRIMARY KEY (TECH_USE_ID, PERSON_ID)
    );

CREATE TABLE if not exists dbo.DM_DISABILITY (
    DISABILITY_ID integer GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PERSON_ID numeric(16) NOT NULL,
    DISABILITY_TYPE varchar,
    CONSTRAINT XPKDM_DISABILITY PRIMARY KEY (DISABILITY_ID, PERSON_ID)
    );

CREATE TABLE if not exists dbo.DM_PERSON_LAST_UPDATED (
    PERSON_LAST_UPDATED_ID integer GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PERSON_ID numeric(16) NOT NULL,
    HOUSING timestamp,
    CONTACT_DETAILS timestamp,
    CONSTRAINT XPKDM_PERSON_LAST_UPDATED PRIMARY KEY (PERSON_LAST_UPDATED_ID, PERSON_ID)
    );

alter table if exists dbo.dm_persons
    add column pronoun varchar(20),
    add column gender_assigned_at_birth bool,
    add column preferred_language varchar(100),
    add column fluent_in_english bool,
    add column interpreter_needed bool,
    add column communication_difficulties bool,
    add column difficulty_making_decisions bool,
    add column communication_difficulties_details varchar,
    add column employment varchar,
    add column immigration_status varchar,
    add column primary_support_reason varchar,
    add column care_provider varchar,
    add column tenure_type varchar,
    add column accomodation_type varchar,
    add column access_to_home varchar,
    add column housing_officer varchar,
    add column living_situation varchar,
    add column housing_staff_in_contact bool,
    add column cautionary_alert bool,
    add column posession_eviction_order varchar,
    add column rent_record varchar,
    add column housing_benefit varchar,
    add column council_tenure_type varchar,
    add column tenancy_household_structure varchar,
    add column mental_health_section_status varchar,
    add column deaf_register varchar,
    add column blind_register varchar,
    add column blue_badge varchar,
    add column open_case bool,
    add column allocated_team varchar;

```
